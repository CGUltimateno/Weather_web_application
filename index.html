<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="container">
<div class="left-bar">
    <div class="navbar">
        <div class="icon">
            <img src="imgs/4052984.png" alt="Weather Icon">
        </div>
        <div class="weathericon">
            <a class="weather" href="index.com"><i class="fa-solid fa-cloud-sun"></i>Weather</a>
        </div>
        <div class="citiesicon">
            <a class="nav-icons" href="cities.html"><i class="fa-solid fa-list"></i>Cities</a>
        </div>
        <div class="Settings">
            <a class="nav-icons" href="settings.html"><i class="fa-solid fa-sliders"></i>Settings</a>
        </div>
    </div>
</div>
<div class="middle-bar">
    <br><br>
    <div class="row">
    <div class="col-lg">
        <div class="main-left-box">
            <h3 style="font-weight: 100;">My Location:</h3>
            <h1 id="cCity" class="main-city"></h1>
            <p id="cRain" class="main-rain"></p>
            <h2 id="cTemp" class="main-degree"></h2>
        </div>
        <div class="main-right-box">
            <img id="mainImage" src="" alt="">
        </div>
    </div>
        <div class="col-lg-2">
            <h3 id="todayIs" class="forecast-main">Today's Forecast</h3>
            <ul class="forecast-list">
                <li class="forecast-item">
                    <h1 id="dayForecastTime1" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon1" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp1" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime2" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon2" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp2" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime3" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon3" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp3" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime4" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon4" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp4" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime5" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon5" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp5" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime6" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon6" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp6" class="forecast-degree">31°</p>
                </li>
                <li class="forecast-item">
                    <h1 id="dayForecastTime7" class="forecast-title">6:00 AM</h1>
                    <img id="dayForecastIcon7" class="forecast-img" src="imgs/cloudy.png" alt="Cloudy">
                    <p id="dayForecastTemp7" class="forecast-degree">31°</p>
                </li>

                <!-- Add more forecast items as needed -->
            </ul>
        </div>
        <div class="col-lg-3">
            <h3 class="condition-main">Air conditions</h3>
            <div class="forecast-info">
            <div class="row-1">
                <div class="col-sm-1">
                    <div class="col-sm-2">
                        <i class="fa-solid fa-temperature-quarter"></i>
                        <h1 class="condition-title">Real Feel</h1>
                    </div>
                    <p id="appTemp" class="condition-degree"></p>
                </div>
                <div class="col-sm-1">
                    <div class="col-sm-2">
                        <i class="fa-solid fa-droplet"></i>
                        <h1 class="condition-title">Chance of Rain</h1>
                    </div>
                    <p id="cRain2" class="condition-degree"></p>
                </div>
            </div>
            <div class="row-2">
                <!-- Second list with two items -->
                <div class="col-sm-1">
                    <div class="col-sm-2">
                        <i class="fa-solid fa-wind"></i>
                        <h1 class="condition-title">Wind</h1>
                    </div>
                    <p id="wind" class="condition-degree"></p>
                </div>
                <div class="col-sm-1">
                    <div class="col-sm-2">
                        <i class="fa-solid fa-sun"></i>
                        <h1 class="condition-title">UV Index</h1>
                    </div>
                    <p id="uv" class="condition-degree"></p>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
<div class="right-bar">
    <div class="week-forecast">
        <div class="icon">
            <h3 class="week-forecast-main">7-DAY FORECAST</h3>
        </div>
        <div class="col-md">
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay1" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon1" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc1" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp1" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay2" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon2" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc2" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp2" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay3" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon3" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc3" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp3" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay4" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon4" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc4" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp4" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay5" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon5" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc5" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp5" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay6" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon6" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc6" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp6" class="forecast-temp">36 /22</p>
                </div>
            </div>
            <div class="row-3">
                <div class="col-sm-3">
                    <p id="weekForecastDay7" class="forecast-day">Monday</p>
                </div>
                <div class="col-sm-4">
                    <img id="weekForecastIcon7" src="imgs/sunny.png" alt="sunny">
                    <p id="weekForecastDesc7" class="forecast-img">Sunny</p>
                </div>
                <div class="col-sm-3">
                    <p id="weekForecastTemp7" class="forecast-temp">36 /22</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            function(position) {

                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                const apiKey = 'a2673531d0754d699184419eb6680596';

                const geocodingApiUrl = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=${apiKey}`;

                fetch(geocodingApiUrl)
                    .then(response => response.json())
                    .then(data => {

                        if (data.results.length > 0) {

                            const city = data.results[0].components.city || data.results[0].components.town;
                            const country = data.results[0].components.country;

                            console.log(`City: ${city}, Country: ${country}`);

                            const weatherApiUrl = `https://api.weatherbit.io/v2.0/current?lat=${latitude}&lon=${longitude}&key=3925b593c06c44cabcc9acbea78508ba`;


                            fetch(weatherApiUrl)
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error(`HTTP error! Status: ${response.status}`);
                                    }
                                    return response.json();
                                })
                                .then(weatherData => {

                                    console.log(weatherData.data[0]);
                                    
                                    document.getElementById("cCity").innerHTML = data.results[0].components.city || data.results[0].components.town;
                                    document.getElementById("cRain").innerHTML = "Chance of Rain: " + weatherData.data[0].precip + "%";
                                    document.getElementById("cRain2").innerHTML = weatherData.data[0].precip + "%";
                                    document.getElementById("cTemp").innerHTML = weatherData.data[0].temp + "°";
                                    document.getElementById("appTemp").innerHTML = weatherData.data[0].app_temp + "°";
                                    document.getElementById("uv").innerHTML = weatherData.data[0].uv;
                                    document.getElementById("wind").innerHTML = weatherData.data[0].wind_spd + " m/s";
                                    const desc = weatherData.data[0].weather.description;
                                    const code = weatherData.data[0].weather.code;
                                    console.log(desc)
                                    console.log(code)
                                    if (code == 800){
                                        document.getElementById("mainImage").src = 'imgs/sunny.png';
                                        document.getElementById("mainImage").alt = desc;
                                    } else if (code == 801, 802, 803){
                                        document.getElementById("mainImage").src = 'imgs/partlyCloudy.png';
                                        document.getElementById("mainImage").alt = desc;
                                    } else if (code == 804, 700, 711, 721, 741, 751, 611, 612){
                                        document.getElementById("mainImage").src = 'imgs/cloudy.png';
                                        document.getElementById("mainImage").alt = desc;
                                    } else if (code == 900, 522, 520, 511, 502, 501, 500, 300, 301, 302){
                                        document.getElementById("mainImage").src = 'imgs/rain.png';
                                        document.getElementById("mainImage").alt = desc;
                                    } else{
                                        document.getElementById("mainImage").src = 'imgs/partlyCloudy.png';
                                        document.getElementById("mainImage").alt = desc;
                                    }
                                })
                                .catch(weatherError => {
                                    console.error('Weather API fetch error:', weatherError);
                                });
                        } else {
                            console.error("No results found");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching geocoding data:", error);
                    });
            },
            function(error) {

                if (error.code === error.PERMISSION_DENIED) {
                    console.error("Permission to access geolocation was denied. Please enable location services in your browser settings.");
                } else {
                    console.error("Error getting geolocation:", error.message);
                }
            }
        );
    } else {
        console.error("Geolocation is not supported by this browser.");
    }

    const currentDate = new Date().toISOString().split('T')[0];
    const apiUrl = 'https://api.weatherbit.io/v2.0/forecast/hourly?city=Cairo&country=EG&key=3925b593c06c44cabcc9acbea78508ba&start_date=' + currentDate + '&hours=25';


        fetch(apiUrl)
          .then(response => {

            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            return response.json();
          })
          .then(data => {

            console.log(data);

            var today = new Date();
            var time = today.getHours()

            const desc = data.data[time].weather.description;
            const code = data.data[time].weather.code;
            console.log(desc);
            console.log(code);

            for (let i = 0; i < 7; i++) {

                const x = time + (i+1);
                let y;

                if (x > 24) {
                    y = x - 24;
                } else{
                    y = time + (i+1);
                }
                
                console.log("y = " + y);
                document.getElementById("dayForecastTime" + (i+1)).innerHTML = y + ":00";

                document.getElementById("dayForecastTemp" + (i+1)).innerHTML = data.data[y].temp + "°";

                const code2 = data.data[y].weather.code;
                console.log(code2);

                if (code2 == 800){
                    document.getElementById("dayForecastIcon" + (i+1)).src = 'imgs/sunny.png';
                    document.getElementById("dayForecastIcon" + (i+1)).alt = desc;
                    console.log("dayForecastIcon" + (i+1));
                } else if (code2 == 801, 802, 803){
                    document.getElementById("dayForecastIcon" + (i+1)).src = 'imgs/partlyCloudy.png';
                    document.getElementById("dayForecastIcon" + (i+1)).alt = desc;
                    console.log("dayForecastIcon" + (i+1));
                } else if (code2 == 804, 700, 711, 721, 741, 751, 611, 612){
                    document.getElementById("dayForecastIcon" + (i+1)).src = 'imgs/cloudy.png';
                    document.getElementById("dayForecastIcon" + (i+1)).alt = desc;
                    console.log("dayForecastIcon" + (i+1));
                } else if (code2 == 900, 522, 520, 511, 502, 501, 500, 300, 301, 302){
                    document.getElementById("dayForecastIcon" + (i+1)).src = 'imgs/rain.png';
                    document.getElementById("dayForecastIcon" + (i+1)).alt = desc;
                    console.log("dayForecastIcon" + (i+1));
                } else{
                    document.getElementById("dayForecastIcon" + (i+1)).src = 'imgs/partlyCloudy.png';
                    document.getElementById("dayForecastIcon" + (i+1)).alt = desc;
                    console.log("dayForecastIcon" + (i+1));
                }


            }

            const apiUrl = 'https://api.weatherbit.io/v2.0/forecast/daily?city=Cairo&country=EG&key=3925b593c06c44cabcc9acbea78508ba';

            fetch(apiUrl)
              .then(response => {

                if (!response.ok) {
                  throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();
              })
              .then(data => {

                console.log(data);
                let currentDay = today.getDay();

                const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

                document.getElementById("todayIs").innerHTML = "Today's Forecast: " + daysOfWeek[currentDay];
                document.getElementById("weekForecastDay1").innerHTML = daysOfWeek[currentDay];

                console.log('Today is ' + daysOfWeek[currentDay]);

                // Display the next 7 days
                for (let i = 0; i < 7; i++) {
                    // Calculate the index of the next day
                    let nextDayIndex = (currentDay + i) % 7;

                    // Display the name of the next day
                    document.getElementById("weekForecastDay" + (i+1)).innerHTML = daysOfWeek[nextDayIndex];

                    document.getElementById("weekForecastDesc" + (i+1)).innerHTML = data.data[i].weather.description;

                    document.getElementById("weekForecastTemp" + (i+1)).innerHTML = data.data[i].high_temp + "°/" + data.data[i].low_temp + "°";

                    const code3 = data.data[i].weather.code;
                    console.log(code3);

                    if (code3 == 800){
                        document.getElementById("weekForecastIcon" + (i+1)).src = 'imgs/sunny.png';
                        document.getElementById("weekForecastIcon" + (i+1)).alt = desc;
                        console.log("weekForecastIcon" + (i+1));
                    } else if (code3 == 801, 802, 803){
                        document.getElementById("weekForecastIcon" + (i+1)).src = 'imgs/partlyCloudy.png';
                        document.getElementById("weekForecastIcon" + (i+1)).alt = desc;
                        console.log("weekForecastIcon" + (i+1));
                    } else if (code3 == 804, 700, 711, 721, 741, 751, 611, 612){
                        document.getElementById("weekForecastIcon" + (i+1)).src = 'imgs/cloudy.png';
                        document.getElementById("weekForecastIcon" + (i+1)).alt = desc;
                        console.log("weekForecastIcon" + (i+1));
                    } else if (code3 == 900, 522, 520, 511, 502, 501, 500, 300, 301, 302){
                        document.getElementById("weekForecastIcon" + (i+1)).src = 'imgs/rain.png';
                        document.getElementById("weekForecastIcon" + (i+1)).alt = desc;
                        console.log("weekForecastIcon" + (i+1));
                    } else{
                        document.getElementById("weekForecastIcon" + (i+1)).src = 'imgs/partlyCloudy.png';
                        document.getElementById("weekForecastIcon" + (i+1)).alt = desc;
                        console.log("weekForecastIcon" + (i+1));
                    }

                    console.log('Day ' + i + ': ' + daysOfWeek[nextDayIndex]);
                }
              })
              .catch(error => {

                console.error('Fetch error:', error);
              });
          })
          .catch(error => {

            console.error('Fetch error:', error);
          });
 
</script>
</body>
</html>